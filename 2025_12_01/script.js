const pages = [
  {
    title: "The Big Trip Begins",
    text: "How do we fit everything in the RV? It is always a puzzle! We go on a big trip once a summer, and today is the day. I am so excited because my best friends, Siena, Lev, and Samuel, are coming too. \"Put these bags over there,\" said Dad. \"And put the painting supplies here on the table.\" We are all happy because we are going to the campground with the big pool!",
    image: `
<svg viewBox="0 0 320 220" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="sky1" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop stop-color="#b3e5fc" offset="0%"/>
      <stop stop-color="#e1f5fe" offset="100%"/>
    </linearGradient>
    <linearGradient id="rv1" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop stop-color="#ffffff" offset="0%"/>
      <stop stop-color="#d7e3f4" offset="100%"/>
    </linearGradient>
  </defs>
  <rect width="320" height="220" fill="url(#sky1)"/>
  <rect y="150" width="320" height="70" fill="#cfd8dc"/>
  <rect x="140" y="150" width="36" height="30" rx="6" fill="#6d4c41" opacity="0.6"/>
  <rect x="110" y="74" width="190" height="76" rx="14" fill="url(#rv1)" stroke="#90a4ae" stroke-width="3"/>
  <rect x="122" y="88" width="46" height="28" rx="6" fill="#b3e5fc"/>
  <rect x="176" y="88" width="52" height="28" rx="6" fill="#b3e5fc"/>
  <rect x="238" y="88" width="46" height="28" rx="6" fill="#b3e5fc"/>
  <rect x="118" y="120" width="170" height="10" rx="4" fill="#cfd8dc"/>
  <circle cx="160" cy="152" r="14" fill="#263238"/>
  <circle cx="160" cy="152" r="6" fill="#b0bec5"/>
  <circle cx="262" cy="152" r="14" fill="#263238"/>
  <circle cx="262" cy="152" r="6" fill="#b0bec5"/>
  <rect x="70" y="122" width="32" height="46" rx="8" fill="#ffe082"/>
  <rect x="48" y="126" width="22" height="42" rx="8" fill="#f48fb1"/>
  <rect x="26" y="130" width="20" height="38" rx="8" fill="#81d4fa"/>
  <circle cx="86" cy="118" r="12" fill="#fbc02d"/>
  <circle cx="60" cy="122" r="10" fill="#ffb74d"/>
  <circle cx="38" cy="126" r="9" fill="#80deea"/>
  <rect x="84" y="154" width="10" height="20" rx="3" fill="#fbc02d"/>
  <rect x="62" y="160" width="10" height="14" rx="3" fill="#f48fb1"/>
  <rect x="40" y="162" width="10" height="12" rx="3" fill="#4db6ac"/>
  <rect x="200" y="68" width="48" height="12" rx="6" fill="#ffcc80"/>
  <circle cx="224" cy="60" r="14" fill="#ffb74d" opacity="0.9"/>
  <text x="132" y="116" font-family="Arial" font-size="9" fill="#1565c0">Canvases</text>
  <text x="255" y="111" font-family="Arial" font-size="9" fill="#37474f">Dad</text>
  <text x="30" y="115" font-family="Arial" font-size="8" fill="#37474f">Friends</text>
</svg>`
  },
  {
    title: "Meeting Pete",
    text: "When we arrived, we saw a beautiful horse. \"What is his name?\" asked Samuel. \"His name is Pete,\" said the rancher. \"Isn't he cute?\" \"Look at those chickens!\" shouted Lev. Just then, a chicken jumped on a log. \"Here is a barn rule,\" said the rancher. \"Please keep your voices low. Put your voice on mute so you don't scare the animals.\"",
    image: `
<svg viewBox="0 0 320 220" xmlns="http://www.w3.org/2000/svg">
  <rect width="320" height="220" fill="#f1f8e9"/>
  <rect y="150" width="320" height="70" fill="#c5e1a5"/>
  <rect x="34" y="110" width="252" height="10" fill="#d7ccc8"/>
  <rect x="34" y="134" width="252" height="10" fill="#d7ccc8"/>
  <rect x="60" y="90" width="12" height="80" fill="#a1887f"/>
  <rect x="120" y="90" width="12" height="80" fill="#a1887f"/>
  <rect x="180" y="90" width="12" height="80" fill="#a1887f"/>
  <rect x="240" y="90" width="12" height="80" fill="#a1887f"/>
  <ellipse cx="110" cy="152" rx="52" ry="20" fill="#bcaaa4"/>
  <path d="M108 82c30 0 54 40 35 60s-54 12-64-10 9-50 29-50z" fill="#8d6e63"/>
  <circle cx="124" cy="105" r="8" fill="#5d4037"/>
  <circle cx="138" cy="112" r="4" fill="#263238"/>
  <path d="M94 112c10-8 22-10 32-2" stroke="#3e2723" stroke-width="4" fill="none"/>
  <circle cx="86" cy="128" r="6" fill="#fbc02d"/>
  <path d="M64 160c10-15 24-18 38-8" stroke="#6d4c41" stroke-width="6" fill="none" stroke-linecap="round"/>
  <g>
    <circle cx="210" cy="160" r="12" fill="#ffcc80"/>
    <circle cx="230" cy="165" r="9" fill="#ffb74d"/>
    <circle cx="198" cy="168" r="9" fill="#ffe082"/>
  </g>
  <g>
    <rect x="214" y="118" width="24" height="18" rx="6" fill="#fff59d"/>
    <polygon points="214,136 228,142 238,136" fill="#fff176"/>
    <circle cx="226" cy="124" r="3" fill="#ef6c00"/>
  </g>
  <rect x="252" y="82" width="46" height="46" rx="10" fill="#ffb74d"/>
  <circle cx="270" cy="74" r="10" fill="#ffcc80"/>
  <rect x="262" y="126" width="14" height="44" rx="5" fill="#6d4c41"/>
  <text x="78" y="170" font-family="Arial" font-size="10" fill="#4e342e">Pete</text>
  <text x="190" y="182" font-family="Arial" font-size="9" fill="#6d4c41">Chickens</text>
  <text x="254" y="106" font-family="Arial" font-size="9" fill="#4e342e">Rancher</text>
</svg>`
  },
  {
    title: "The Swimming Pool",
    text: "After visiting Pete, we ran to the pool. \"Watch how I do a handstand!\" I yelled. I did a gymnastics flip into the water. It was a big milestone for me! Siena and Lev cheered. Once we got out of the pool, we saw a toy that broke. \"I can fix it!\" said Samuel. \"I refuse to let it stay broken.\" We like Samuel because he is very helpful.",
    image: `
<svg viewBox="0 0 320 220" xmlns="http://www.w3.org/2000/svg">
  <rect width="320" height="220" fill="#e3f2fd"/>
  <rect x="18" y="44" width="284" height="152" rx="26" fill="#4fc3f7"/>
  <rect x="32" y="60" width="256" height="120" rx="22" fill="#29b6f6"/>
  <path d="M60 160c12-26 30-30 48-8" stroke="#b3e5fc" stroke-width="5" fill="none" stroke-linecap="round"/>
  <circle cx="118" cy="126" r="18" fill="#fff9c4" opacity="0.8"/>
  <rect x="136" y="136" width="46" height="18" rx="8" fill="#ffcc80" transform="rotate(-12 160 145)"/>
  <rect x="80" y="88" width="24" height="44" rx="8" fill="#ff8a65"/>
  <rect x="92" y="70" width="14" height="22" rx="8" fill="#ff8a65"/>
  <rect x="106" y="70" width="8" height="40" rx="4" fill="#4db6ac" transform="rotate(70 110 90)"/>
  <circle cx="92" cy="68" r="10" fill="#ffe082"/>
  <path d="M88 68c6-5 12-5 18 0" stroke="#5d4037" stroke-width="3" fill="none" stroke-linecap="round"/>
  <rect x="186" y="142" width="30" height="16" rx="6" fill="#cfd8dc"/>
  <path d="M190 148c0-8 20-8 20 0" stroke="#607d8b" stroke-width="3" fill="none" stroke-linecap="round"/>
  <rect x="206" y="86" width="30" height="44" rx="10" fill="#81c784"/>
  <circle cx="221" cy="80" r="10" fill="#aed581"/>
  <rect x="214" y="128" width="10" height="20" rx="3" fill="#81c784"/>
  <text x="70" y="156" font-family="Arial" font-size="10" fill="#0d47a1">Handstand!</text>
  <text x="182" y="166" font-family="Arial" font-size="9" fill="#37474f">Broken toy</text>
</svg>`
  },
  {
    title: "The Painting Party",
    text: "On the eve of the last day, we decided to paint. We turned on a lantern that looked like a glowing globe. Suddenly, we heard a loud sound. Thump, thump, thump! \"Is it a stampede of horses?\" asked Siena. No! It was just Dad running to tell us dinner was ready. \"I made chicken!\" Dad said. \"How wonderful!\" we all shouted.",
    image: `
<svg viewBox="0 0 320 220" xmlns="http://www.w3.org/2000/svg">
  <rect width="320" height="220" fill="#0c1a2e"/>
  <circle cx="70" cy="70" r="36" fill="#ffe082" opacity="0.2"/>
  <circle cx="70" cy="70" r="26" fill="#fff59d" opacity="0.5"/>
  <circle cx="70" cy="70" r="18" fill="#fff9c4"/>
  <rect x="30" y="126" width="260" height="16" rx="6" fill="#8d6e63"/>
  <rect x="44" y="142" width="232" height="12" rx="6" fill="#a1887f"/>
  <rect x="48" y="104" width="32" height="30" rx="8" fill="#ffcc80"/>
  <rect x="92" y="108" width="32" height="30" rx="8" fill="#f48fb1"/>
  <rect x="136" y="106" width="32" height="30" rx="8" fill="#4dd0e1"/>
  <rect x="180" y="110" width="32" height="30" rx="8" fill="#aed581"/>
  <rect x="224" y="108" width="32" height="30" rx="8" fill="#ffab91"/>
  <g stroke="#ffcc80" stroke-width="6" stroke-linecap="round">
    <line x1="262" y1="70" x2="280" y2="120"/>
    <line x1="246" y1="74" x2="280" y2="120"/>
  </g>
  <circle cx="272" cy="128" r="8" fill="#ffb74d"/>
  <path d="M50 136c14-10 30-10 44 0" stroke="#f5f5f5" stroke-width="2" opacity="0.6"/>
  <path d="M140 136c14-10 30-10 44 0" stroke="#f5f5f5" stroke-width="2" opacity="0.6"/>
  <path d="M230 136c14-10 30-10 44 0" stroke="#f5f5f5" stroke-width="2" opacity="0.6"/>
  <text x="176" y="98" font-family="Arial" font-size="10" fill="#cfd8dc">Lantern glow</text>
  <text x="248" y="150" font-family="Arial" font-size="10" fill="#cfd8dc">Dad rushing</text>
</svg>`
  },
  {
    title: "Time to Go Home",
    text: "We cleaned up our paints. \"I love these paintings,\" said Mom. We were sad to leave because we had so much fun. We said goodbye to Pete the horse. \"I wonder how long until our next trip?\" asked Lev. \"Maybe once school is over,\" I said. Camping with friends is the best rule of all!",
    image: `
<svg viewBox="0 0 320 220" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="sunset2" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop stop-color="#ffb74d" offset="0%"/>
      <stop stop-color="#ffcc80" offset="40%"/>
      <stop stop-color="#b3c2f2" offset="100%"/>
    </linearGradient>
  </defs>
  <rect width="320" height="220" fill="url(#sunset2)"/>
  <rect y="150" width="320" height="70" fill="#d7d8ef"/>
  <rect x="40" y="114" width="200" height="46" rx="14" fill="#e3f2fd" stroke="#9fa8da" stroke-width="3"/>
  <rect x="44" y="126" width="50" height="20" rx="6" fill="#b3e5fc"/>
  <rect x="104" y="126" width="68" height="20" rx="6" fill="#b3e5fc"/>
  <rect x="182" y="126" width="50" height="20" rx="6" fill="#b3e5fc"/>
  <circle cx="86" cy="162" r="12" fill="#3949ab"/>
  <circle cx="86" cy="162" r="5" fill="#b0bec5"/>
  <circle cx="196" cy="162" r="12" fill="#3949ab"/>
  <circle cx="196" cy="162" r="5" fill="#b0bec5"/>
  <rect x="248" y="120" width="40" height="50" rx="8" fill="#bcaaa4"/>
  <rect x="246" y="98" width="46" height="24" rx="8" fill="#8d6e63"/>
  <text x="62" y="118" font-family="Arial" font-size="10" fill="#1b3c6b">RV friends</text>
  <text x="252" y="134" font-family="Arial" font-size="10" fill="#4e342e">Pete</text>
  <rect x="20" y="96" width="38" height="32" rx="6" fill="#ffb74d"/>
  <text x="22" y="116" font-family="Arial" font-size="10" fill="#6d4c41">Mom</text>
  <path d="M28 140c22-16 44-16 60 2" stroke="#6a1b9a" stroke-width="2" opacity="0.4"/>
  <path d="M210 150c12-10 26-10 40 0" stroke="#6a1b9a" stroke-width="2" opacity="0.4"/>
</svg>`
  },
  {
    title: "Spelling Star!",
    text: "Can you read all the words from our story? High Frequency Words: how | once | because. Regular Words: eve | mute | rule | these | here | globe | broke | those | cute | Pete. Challenge Words: milestone | stampede | refuse. Try the quiz to become today's spelling star!",
    image: `
<svg viewBox="0 0 320 220" xmlns="http://www.w3.org/2000/svg">
  <rect width="320" height="220" fill="#0f172a"/>
  <g stroke="#ffd54f" stroke-width="2" fill="none">
    <circle cx="70" cy="70" r="16"/>
    <circle cx="120" cy="120" r="12"/>
    <circle cx="200" cy="70" r="18"/>
    <circle cx="250" cy="140" r="14"/>
  </g>
  <g fill="#ffeb3b">
    <circle cx="70" cy="70" r="6"/>
    <circle cx="120" cy="120" r="5"/>
    <circle cx="200" cy="70" r="7"/>
    <circle cx="250" cy="140" r="5"/>
  </g>
  <rect x="70" y="150" width="180" height="46" rx="10" fill="#1e2a3f" stroke="#3f51b5" stroke-width="2"/>
  <text x="88" y="176" font-family="Arial" font-size="12" fill="#e8eaf6">Spelling Star Challenge</text>
  <text x="96" y="194" font-family="Arial" font-size="12" fill="#c5cae9">Fill the missing letters!</text>
  <polygon points="40,40 48,60 30,50 50,50 32,60" fill="#ff8a65" opacity="0.8"/>
  <polygon points="280,40 288,60 270,50 290,50 272,60" fill="#4dd0e1" opacity="0.8"/>
</svg>`
  }
];

const quizBank = [
  { prompt: "h_w", answer: "how" },
  { prompt: "on_e", answer: "once" },
  { prompt: "be_a_se", answer: "because" },
  { prompt: "_ve", answer: "eve" },
  { prompt: "m_te", answer: "mute" },
  { prompt: "r_le", answer: "rule" },
  { prompt: "th_se", answer: "these" },
  { prompt: "h_re", answer: "here" },
  { prompt: "gl_be", answer: "globe" },
  { prompt: "br_ke", answer: "broke" },
  { prompt: "tho_e", answer: "those" },
  { prompt: "cu_e", answer: "cute" },
  { prompt: "_ete", answer: "Pete" },
  { prompt: "mile_t_ne", answer: "milestone" },
  { prompt: "st_mpede", answer: "stampede" },
  { prompt: "re_use", answer: "refuse" }
];

const pageNumberEl = document.getElementById("page-number");
const pageTitleEl = document.getElementById("page-title");
const pageTextEl = document.getElementById("page-text");
const pageImageEl = document.getElementById("page-image");
const prevBtn = document.getElementById("prev-btn");
const nextBtn = document.getElementById("next-btn");
const playBtn = document.getElementById("play-btn");
const restartBtn = document.getElementById("restart-btn");
const quizListEl = document.getElementById("quiz-list");
const checkAnswersBtn = document.getElementById("check-answers");
const retryQuizBtn = document.getElementById("retry-quiz");
const quizFeedbackEl = document.getElementById("quiz-feedback");
const quizSection = document.getElementById("quiz-section");

let currentPage = 0;
let currentUtterance = null;

function renderPage() {
  const page = pages[currentPage];
  pageNumberEl.textContent = currentPage + 1;
  pageTitleEl.textContent = page.title;
  pageTextEl.textContent = page.text;
  pageImageEl.innerHTML = page.image;
  prevBtn.disabled = currentPage === 0;
  nextBtn.disabled = currentPage === pages.length - 1;
  quizSection.classList.toggle("highlight", currentPage === pages.length - 1);
}

function speak(text) {
  if (!("speechSynthesis" in window)) {
    quizFeedbackEl.textContent = "Speech not supported in this browser.";
    return;
  }
  window.speechSynthesis.cancel();
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.rate = 0.98;
  utterance.pitch = 1;
  currentUtterance = utterance;
  window.speechSynthesis.speak(utterance);
}

function goToPage(index) {
  if (index < 0 || index >= pages.length) return;
  if ("speechSynthesis" in window) {
    window.speechSynthesis.cancel();
  }
  currentPage = index;
  renderPage();
}

function nextPage() {
  goToPage(Math.min(currentPage + 1, pages.length - 1));
}

function prevPage() {
  goToPage(Math.max(currentPage - 1, 0));
}

function restartBook() {
  currentPage = 0;
  renderPage();
  speak(pages[currentPage].text);
}

function sampleQuizItems(count = 6) {
  const shuffled = [...quizBank].sort(() => Math.random() - 0.5);
  return shuffled.slice(0, count);
}

function buildQuiz() {
  quizListEl.innerHTML = "";
  const items = sampleQuizItems();
  items.forEach((item, idx) => {
    const row = document.createElement("div");
    row.className = "quiz__item";

    const label = document.createElement("div");
    label.className = "quiz__label";
    label.textContent = `${idx + 1}. ${item.prompt}`;

    const input = document.createElement("input");
    input.type = "text";
    input.maxLength = item.answer.length;
    input.dataset.answer = item.answer.toLowerCase();
    input.className = "quiz__input";
    input.autocomplete = "off";

    row.appendChild(label);
    row.appendChild(input);
    quizListEl.appendChild(row);
  });
  quizFeedbackEl.textContent = "";
}

function checkAnswers() {
  const inputs = quizListEl.querySelectorAll("input");
  let correct = 0;
  inputs.forEach((input) => {
    const expected = input.dataset.answer;
    const guess = input.value.trim().toLowerCase();
    const isCorrect = guess === expected;
    input.classList.toggle("correct", isCorrect);
    input.classList.toggle("incorrect", !isCorrect);
    if (isCorrect) correct += 1;
  });
  quizFeedbackEl.textContent = `You got ${correct}/${inputs.length} right${correct === inputs.length ? "! âœ¨" : ". Keep going!"}`;
}

prevBtn.addEventListener("click", prevPage);
nextBtn.addEventListener("click", nextPage);
playBtn.addEventListener("click", () => speak(pages[currentPage].text));
restartBtn.addEventListener("click", restartBook);
checkAnswersBtn.addEventListener("click", checkAnswers);
retryQuizBtn.addEventListener("click", buildQuiz);

renderPage();
buildQuiz();
